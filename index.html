<body class="p-4 md:p-8">
    <div class="max-w-screen-2xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">CloudShapers AI</h1>
                <p class="text-slate-400 font-medium">Matching Dashboard</p>
            </div>
            <button onclick="fetchData()" class="bg-blue-600 hover:bg-blue-700 px-5 py-2.5 rounded-lg transition flex items-center shadow-lg"><i class="fas fa-sync-alt mr-2"></i> Verversen</button>
        </header>

        <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>

        <div class="glass p-4 rounded-xl mb-8 flex flex-col lg:flex-row gap-4 justify-between items-center sticky top-4 z-10 shadow-2xl">
            <div class="relative w-full lg:w-96">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i class="fas fa-search text-slate-400"></i></div>
                <input type="text" id="searchInput" onkeyup="applyFilters()" placeholder="Zoek op rol, klant..." class="bg-slate-800 border border-slate-600 text-white text-sm rounded-lg block w-full pl-10 p-2.5">
            </div>
            <div class="flex flex-wrap gap-2">
                <button onclick="setFilter('RELEVANT')" id="btn-RELEVANT" class="filter-active border border-slate-600 bg-slate-800 text-slate-300 px-4 py-2 rounded-lg text-sm font-medium">Relevant</button>
                <button onclick="setFilter('IRRELEVANT')" id="btn-IRRELEVANT" class="border border-slate-600 bg-slate-800 text-slate-300 px-4 py-2 rounded-lg text-sm font-medium">Niet Relevant</button>
                <button onclick="setFilter('ALL')" id="btn-ALL" class="border border-slate-600 bg-slate-800 text-slate-300 px-4 py-2 rounded-lg text-sm font-medium">Alles</button>
            </div>
        </div>

        <div id="app-container" class="grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-6"></div>
    </div>

    <script>
        const API_URL = 'https://cloudshaper-api.timosteen22.workers.dev';
        let allItems = [];
        let currentFilter = 'RELEVANT';

        async function fetchData() {
            const response = await fetch(API_URL);
            allItems = await response.json();
            updateStats();
            applyFilters();
        }

        function updateStats() {
            const total = allItems.length;
            const relevant = allItems.filter(i => i.is_relevant === 1).length;
            const irrelevant = total - relevant;
            const goMatches = allItems.filter(i => i.match_status === 'GO' && i.is_relevant === 1).length;

            document.getElementById('stats').innerHTML = `
                <div class="glass p-5 rounded-xl border-l-4 border-blue-500"><p class="text-slate-400 text-xs font-bold uppercase tracking-wider">Totaal Verwerkt</p><p class="text-2xl font-bold">${total}</p></div>
                <div class="glass p-5 rounded-xl border-l-4 border-green-500"><p class="text-slate-400 text-xs font-bold uppercase tracking-wider">Relevant</p><p class="text-2xl font-bold text-green-400">${relevant}</p></div>
                <div class="glass p-5 rounded-xl border-l-4 border-red-500"><p class="text-slate-400 text-xs font-bold uppercase tracking-wider">Niet Relevant (Ruis)</p><p class="text-2xl font-bold text-red-400">${irrelevant}</p></div>
                <div class="glass p-5 rounded-xl border-l-4 border-purple-500"><p class="text-slate-400 text-xs font-bold uppercase tracking-wider">Directe Matches</p><p class="text-2xl font-bold text-purple-400">${goMatches}</p></div>
            `;
        }

        function setFilter(f) { 
            currentFilter = f; 
            document.querySelectorAll('[id^="btn-"]').forEach(b => b.classList.remove('filter-active'));
            document.getElementById(`btn-${f}`).classList.add('filter-active');
            applyFilters(); 
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allItems.filter(item => {
                const matchesFilter = (currentFilter === 'ALL') || 
                                     (currentFilter === 'RELEVANT' && item.is_relevant === 1) || 
                                     (currentFilter === 'IRRELEVANT' && item.is_relevant === 0);
                const matchesSearch = item.rol.toLowerCase().includes(search) || item.klant.toLowerCase().includes(search);
                return matchesFilter && matchesSearch;
            });
            renderDashboard(filtered);
        }

        function renderDashboard(items) {
            document.getElementById('app-container').innerHTML = items.map(item => {
                let kandidaten = [];
                try { kandidaten = JSON.parse(item.kandidaten_json) || []; } catch(e) {}
                const statusClass = item.match_status === 'GO' ? 'status-go' : (item.match_status === 'STRETCH' ? 'status-stretch' : 'status-nogo');

                return `
                    <div class="glass p-5 rounded-xl shadow-xl transition border border-slate-700/50 flex flex-col ${item.is_relevant === 0 ? 'opacity-75 grayscale-[0.5]' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold uppercase text-blue-400">${item.klant}</span>
                            <div class="px-3 py-1 rounded-full font-bold text-[10px] uppercase ${statusClass}">${item.match_status}</div>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3">${item.rol}</h3>
                        <div class="flex flex-wrap gap-x-4 gap-y-1 mb-4 text-xs text-slate-400 font-medium">
                            <span><i class="fas fa-map-marker-alt text-slate-500 w-3"></i> ${item.locatie}</span>
                            <span><i class="fas fa-euro-sign text-slate-500 w-3"></i> ${item.tarief}/u</span>
                            <span><i class="fas fa-calendar-star text-blue-500 w-3"></i> Start: ${item.startdatum}</span>
                        </div>
                        <div class="bg-slate-900/50 p-3 rounded-lg mb-4 text-sm text-slate-300 leading-relaxed italic border border-slate-700/50">"${item.samenvatting}"</div>
                        <div class="mt-auto">
                            <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2 border-b border-slate-700/50 pb-1">Top 3 Analyse</h4>
                            <div class="space-y-3">
                                ${kandidaten.length > 0 ? kandidaten.map(k => `
                                    <div class="flex items-start gap-2 bg-slate-800/30 p-2 rounded-md border border-slate-700/30">
                                        <div class="mt-0.5 ${k.status === 'GO' ? 'text-green-400' : 'text-amber-400'}"><i class="fas fa-check-circle"></i></div>
                                        <div><p class="font-bold text-sm text-slate-200">${k.naam}</p><p class="text-slate-400 text-xs mt-0.5">${k.reden}</p></div>
                                    </div>
                                `).join('') : '<p class="text-xs text-slate-600 italic">Geen match resultaten.</p>'}
                            </div>
                        </div>
                        <div class="mt-6 pt-3 border-t border-slate-800/50 flex justify-between items-center text-[9px] text-slate-500 uppercase tracking-widest">
                            <span><i class="far fa-calendar-alt"></i> ${new Date(item.datum).toLocaleString()}</span>
                            <button onclick="deleteItem(${item.id})"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        fetchData();
    </script>
</body>
